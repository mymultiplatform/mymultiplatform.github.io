<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Coverage Debug (Inches Only) - Sheet W×H + Direction</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 16px; }
    .box { border: 1px solid #ccc; border-radius: 10px; padding: 12px; max-width: 980px; }
    label { display:block; margin-top: 10px; font-size: 13px; }
    input, button {
      font-size: 14px; padding: 10px; border-radius: 8px; border: 1px solid #bbb;
      width: 100%; box-sizing: border-box;
    }
    button { cursor:pointer; width:auto; }
    .row { display:flex; gap: 10px; flex-wrap: wrap; align-items: end; }
    .row > div { flex: 1; min-width: 200px; }
    canvas { border:1px solid #333; margin-top: 12px; background:#fff; width: 100%; height: auto; }
    .meta { margin-top: 10px; font-size: 13px; color:#222; line-height: 1.35; }
    .warn { color:#8a4b00; font-weight:700; }
    .ok { color:#0a7a2f; font-weight:700; }
    .small { font-size:12px; color:#444; margin-top:6px; line-height: 1.35; }
    .dirRow { display:flex; gap: 12px; flex-wrap: wrap; align-items:center; margin-top: 6px; }
    .dirRow label { margin: 0; font-size: 13px; display:flex; gap: 6px; align-items:center; }
    .dirRow input[type="radio"] { width:auto; }
  </style>
</head>
<body>

<h2>Coverage Debug (Inches Only) — Sheet Width × Height + Direction</h2>

<div class="box">
  <div class="small">
    Enter inches like <b>60"</b> (must include the quote symbol).  
    Direction draws an arrow at the center of each sheet (pattern/grain).
  </div>

  <div class="row">
    <div>
      <label>Target Width (in)</label>
      <input id="targetW" value='1902"' />
    </div>
    <div>
      <label>Target Height (in)</label>
      <input id="targetH" value='18920"' />
    </div>
  </div>

  <div class="row">
    <div>
      <label>Sheet Width (in)</label>
      <input id="sheetW" value='60"' />
    </div>
    <div>
      <label>Sheet Height (in)</label>
      <input id="sheetH" value='96"' />
    </div>
  </div>

  <label>Direction / Pattern</label>
  <div class="dirRow">
    <label><input type="radio" name="dir" value="N" checked> North</label>
    <label><input type="radio" name="dir" value="E"> East</label>
    <label><input type="radio" name="dir" value="S"> South</label>
    <label><input type="radio" name="dir" value="W"> West</label>

    <div style="display:flex; gap:8px; align-items:center; flex-wrap:wrap;">
      <span class="small" style="margin:0;">or Degrees:</span>
      <input id="deg" value='' placeholder='e.g. 90' style="width: 120px;" />
      <span class="small" style="margin:0;">(0=East, 90=South, 180=West, 270=North)</span>
    </div>
  </div>

  <div class="row" style="margin-top:10px;">
    <div style="flex:0 0 auto;">
      <button onclick="run()">Draw</button>
    </div>
  </div>

  <div id="meta" class="meta"></div>

  <canvas id="cv" width="1100" height="700"></canvas>

  <div class="small">
    <b>Legend:</b> Gray outline = target. Solid boxes = full sheets. Dashed boxes = cut sheets on edges. Arrow = pattern direction.
  </div>
</div>

<script>
function parseInchesStrict(s){
  if (typeof s !== 'string') return NaN;
  const str = s.trim();
  if (!str.endsWith('"')) return NaN;
  const num = str.slice(0, -1).trim();
  if (!/^[0-9]*\.?[0-9]+$/.test(num)) return NaN;
  return Number(num);
}

function getSelectedDir(){
  const radios = document.querySelectorAll('input[name="dir"]');
  for (const r of radios) if (r.checked) return r.value;
  return "N";
}

// Map direction to angle in radians
// Use canvas coordinate system: +x right, +y down
// We'll define:
// East = 0°, South = 90°, West = 180°, North = 270°
function dirToRadians(dir){
  switch(dir){
    case "E": return 0;
    case "S": return Math.PI/2;
    case "W": return Math.PI;
    case "N": return 3*Math.PI/2;
    default: return 3*Math.PI/2;
  }
}

function degToRadians(deg){
  return (deg * Math.PI) / 180;
}

function drawArrow(ctx, cx, cy, len, angleRad){
  // Arrow from center going forward "len"
  const x2 = cx + Math.cos(angleRad) * len;
  const y2 = cy + Math.sin(angleRad) * len;

  ctx.save();
  ctx.lineWidth = 2;
  ctx.strokeStyle = "#111";
  ctx.fillStyle = "#111";

  // main line
  ctx.beginPath();
  ctx.moveTo(cx, cy);
  ctx.lineTo(x2, y2);
  ctx.stroke();

  // arrow head
  const headLen = Math.max(6, len * 0.18);
  const a1 = angleRad + Math.PI * 0.85;
  const a2 = angleRad - Math.PI * 0.85;

  ctx.beginPath();
  ctx.moveTo(x2, y2);
  ctx.lineTo(x2 + Math.cos(a1) * headLen, y2 + Math.sin(a1) * headLen);
  ctx.lineTo(x2 + Math.cos(a2) * headLen, y2 + Math.sin(a2) * headLen);
  ctx.closePath();
  ctx.fill();

  // small center dot
  ctx.beginPath();
  ctx.arc(cx, cy, 2.2, 0, Math.PI*2);
  ctx.fill();

  ctx.restore();
}

function run(){
  const tW = parseInchesStrict(document.getElementById('targetW').value);
  const tH = parseInchesStrict(document.getElementById('targetH').value);
  const sW = parseInchesStrict(document.getElementById('sheetW').value);
  const sH = parseInchesStrict(document.getElementById('sheetH').value);

  const meta = document.getElementById('meta');
  const cv = document.getElementById('cv');
  const ctx = cv.getContext('2d');
  ctx.setTransform(1,0,0,1,0,0);
  ctx.clearRect(0,0,cv.width,cv.height);

  if (![tW,tH,sW,sH].every(v => isFinite(v) && v > 0)){
    meta.innerHTML = `<span class="warn">Inputs must be inches like 60"</span>`;
    return;
  }

  // direction angle: degrees overrides radios if provided
  const degStr = document.getElementById('deg').value.trim();
  let angleRad;
  if (degStr !== ""){
    const deg = Number(degStr);
    if (!isFinite(deg)){
      meta.innerHTML = `<span class="warn">Degrees must be a number (0–359).</span>`;
      return;
    }
    angleRad = degToRadians(((deg % 360) + 360) % 360);
  } else {
    angleRad = dirToRadians(getSelectedDir());
  }

  const cols = Math.ceil(tW / sW);
  const rows = Math.ceil(tH / sH);
  const count = cols * rows;

  const coveredW = cols * sW;
  const coveredH = rows * sH;

  // Fit view to covered area (so you see full grid)
  const pad = 30;
  const worldW = Math.max(tW, coveredW);
  const worldH = Math.max(tH, coveredH);
  const scale = Math.min((cv.width - 2*pad)/worldW, (cv.height - 2*pad)/worldH);

  const X = (x)=> pad + x*scale;
  const Y = (y)=> pad + y*scale;
  const W = (w)=> w*scale;
  const H = (h)=> h*scale;

  // Draw sheet tiles (trimmed at target edges)
  for (let r=0; r<rows; r++){
    for (let c=0; c<cols; c++){
      const x = c*sW;
      const y = r*sH;

      // edge cuts
      const cutW = Math.min(sW, tW - x);
      const cutH = Math.min(sH, tH - y);
      const isCut = (cutW < sW) || (cutH < sH);

      const drawW = Math.max(0, cutW);
      const drawH = Math.max(0, cutH);
      if (drawW <= 0 || drawH <= 0) continue;

      // fill
      ctx.fillStyle = isCut ? "rgba(220,220,220,0.75)" : "rgba(200,200,200,0.55)";
      ctx.fillRect(X(x), Y(y), W(drawW), H(drawH));

      // stroke
      ctx.save();
      ctx.strokeStyle = "#111";
      ctx.lineWidth = 1;
      if (isCut) ctx.setLineDash([6,4]);
      else ctx.setLineDash([]);
      ctx.strokeRect(X(x), Y(y), W(drawW), H(drawH));
      ctx.restore();

      // arrow in sheet center (use the drawn size so cut pieces show smaller arrows)
      const cx = X(x) + W(drawW)/2;
      const cy = Y(y) + H(drawH)/2;
      const len = Math.min(W(drawW), H(drawH)) * 0.32;
      drawArrow(ctx, cx, cy, len, angleRad);
    }
  }

  // Draw target outline on top
  ctx.save();
  ctx.strokeStyle = "#555";
  ctx.lineWidth = 2;
  ctx.setLineDash([]);
  ctx.strokeRect(X(0), Y(0), W(tW), H(tH));
  ctx.restore();

  const overW = coveredW - tW;
  const overH = coveredH - tH;

  const angleDeg = Math.round((angleRad * 180 / Math.PI) * 1000)/1000;

  meta.innerHTML = `
    <div><span class="ok">Sheets:</span> ${count} total (${cols} across × ${rows} down)</div>
    <div>Target: ${tW}" × ${tH}"</div>
    <div>Sheet: ${sW}" × ${sH}"</div>
    <div>Covered: ${coveredW}" × ${coveredH}"</div>
    <div>Overhang: +${overW}" width, +${overH}" height</div>
    <div>Direction angle: <b>${angleDeg}°</b> (0=East, 90=South, 180=West, 270=North)</div>
  `;
}
</script>

</body>
</html>
