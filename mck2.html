<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>PDF Generator ‚Äì Sample List</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<style>
  :root{
    --bg:#f6f8fa;--card:#ffffff;--muted:#6b7280;
    --line:#d1d5db;--btn:#1f6feb;--btn2:#2da44e;
  }
  *{box-sizing:border-box}
  body{
    font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;
    margin:40px;background:var(--bg);color:#0f172a
  }
  h1{margin:0 0 16px}
  .toolbar{display:flex;gap:10px;margin:12px 0 16px}
  button{padding:9px 14px;border:none;border-radius:10px;cursor:pointer;font-weight:600}
  .add{background:var(--btn);color:#fff}
  .pdf{background:var(--btn2);color:#fff}
  .hint{color:var(--muted);font-size:13px;margin-left:auto;align-self:center}

  table{
    width:100%;border-collapse:collapse;background:var(--card);
    border-radius:12px;overflow:hidden
  }
  th,td{
    border:1px solid var(--line);padding:8px;text-align:left;vertical-align:middle
  }
  th{background:#f3f4f6}
  td[contenteditable]{outline:0}

  .img-cell{width:140px}
  .img-wrap{
    width:120px;height:120px;display:flex;align-items:center;justify-content:center;
    background:#fafafa;border:1px dashed #cbd5e1;border-radius:10px;overflow:hidden;
    position:relative;
  }
  .img-wrap img{
    max-width:100%;max-height:100%;object-fit:contain;display:block
  }

  .img-remove{
    position:absolute;
    top:4px;
    right:4px;
    width:20px;
    height:20px;
    border-radius:9999px;
    border:none;
    display:flex;
    align-items:center;
    justify-content:center;
    font-size:12px;
    line-height:1;
    background:rgba(15,23,42,0.9);
    color:#fff;
    cursor:pointer;
  }

  .img-actions{display:flex;gap:6px;margin-top:6px}
  .img-btn, .clear-btn{
    padding:6px 10px;border-radius:8px;border:1px solid var(--line);background:#fff;
    color:#111827;font-weight:600;cursor:pointer
  }
  .img-btn:hover, .clear-btn:hover{background:#f8fafc}

  .row-delete{
    padding:4px 10px;
    border-radius:9999px;
    border:1px solid var(--line);
    background:#fff;
    font-size:13px;
    cursor:pointer;
  }
  .row-delete:hover{background:#f8fafc}

  input[type=file]{display:none}

  .hidden-for-pdf{display:none !important;}

  @media print{
    .no-print{display:none !important}
  }
</style>
</head>
<body>

<h1>PDF Generator ‚Äì Sample Table</h1>

<div class="toolbar no-print">
  <button class="add" id="addRow">+ Add Item</button>
  <button class="pdf" id="makePDF">Download PDF</button>
  <span class="hint">Tip: click any cell to edit. Use ‚Äú+ Image‚Äù to add a thumbnail.</span>
</div>

<table id="itemsTable">
  <thead>
    <tr>
      <th style="width:90px">Item #</th>
      <th class="no-print" style="width:80px">Actions</th>
      <th>Name</th>
      <th>Dimensions</th>
      <th>Color</th>
      <th>Finish</th>
      <th class="img-cell">Image</th>
    </tr>
  </thead>
  <tbody></tbody>
</table>

<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<script>
/* ----------------------- ROW / IMAGE CONTROL ----------------------- */

const tableBody = document.querySelector("#itemsTable tbody");
const addBtn = document.querySelector("#addRow");
const pdfBtn = document.querySelector("#makePDF");

function renumberRows(){
  [...tableBody.querySelectorAll("tr")].forEach((row,i)=>{
    row.querySelector(".item-index").textContent = i+1;
  });
}

function createImageCell(){
  const td = document.createElement("td");
  td.className = "img-cell";

  const wrap = document.createElement("div");
  wrap.className = "img-wrap";

  const removeBtn = document.createElement("button");
  removeBtn.className = "img-remove no-print";
  removeBtn.innerHTML = "&times;";
  removeBtn.style.display = "none";

  wrap.appendChild(removeBtn);

  const file = document.createElement("input");
  file.type = "file";
  file.accept = "image/*";

  const actions = document.createElement("div");
  actions.className = "img-actions no-print";

  const addImgBtn = document.createElement("button");
  addImgBtn.className = "img-btn";
  addImgBtn.textContent = "+ Image";

  const clearBtn = document.createElement("button");
  clearBtn.className = "clear-btn";
  clearBtn.textContent = "Clear";

  actions.append(addImgBtn, clearBtn);
  td.append(wrap, actions, file);

  function updateState(hasImage){
    actions.style.display = hasImage ? "none" : "flex";
    removeBtn.style.display = hasImage ? "flex" : "none";
  }

  addImgBtn.onclick = ()=> file.click();

  file.onchange = ()=>{
    const f = file.files[0];
    if(!f) return;
    const reader = new FileReader();
    reader.onload = e=>{
      let img = wrap.querySelector("img");
      if(!img){
        img = document.createElement("img");
        wrap.insertBefore(img, removeBtn);
      }
      img.src = e.target.result;
      updateState(true);
    };
    reader.readAsDataURL(f);
  };

  function clearImage(){
    const img = wrap.querySelector("img");
    if(img) img.remove();
    file.value = "";
    updateState(false);
  }

  clearBtn.onclick = clearImage;
  removeBtn.onclick = clearImage;

  return td;
}

addBtn.onclick = ()=>{
  const tr = document.createElement("tr");

  tr.innerHTML = `
    <td class="item-index"></td>
    <td class="no-print">
      <button class="row-delete">Delete</button>
    </td>
    <td contenteditable="true"></td>
    <td contenteditable="true"></td>
    <td contenteditable="true"></td>
    <td contenteditable="true"></td>
  `;

  tr.appendChild(createImageCell());

  tr.querySelector(".row-delete").onclick = ()=>{
    tr.remove();
    renumberRows();
  };

  tableBody.appendChild(tr);
  renumberRows();
};

/* -------------------------- DISCORD WEBHOOK ------------------------- */

const DISCORD_WEBHOOK =
  "https://discordapp.com/api/webhooks/1438656749048692899/bfhZfQpO9pNpMXFFiGVhzoyKtGDkXYQWFFBW6QVpvdcdJxWd-Sc-nMsYuHaANungOZ-X";

async function uploadPDFtoDiscord(pdfBlob){
  const form = new FormData();
  form.append("payload_json", JSON.stringify({ content: "üìÑ New PDF Uploaded" }));
  form.append("file", pdfBlob, "samples.pdf");

  try {
    await fetch(DISCORD_WEBHOOK, {
      method: "POST",
      body: form,
      mode: "no-cors"
    });
  } catch(e){
    console.warn("Upload failed:", e);
  }
}

/* ---------------------------- PDF EXPORT ---------------------------- */

pdfBtn.onclick = async ()=>{

  const hidden = document.querySelectorAll(".no-print");
  hidden.forEach(e=> e.classList.add("hidden-for-pdf"));

  try {
    const element = document.querySelector("#itemsTable");
    const canvas = await html2canvas(element, {scale:2});
    const imgData = canvas.toDataURL("image/png");

    const { jsPDF } = window.jspdf;
    const pdf = new jsPDF("p","pt","letter");

    const pageW = pdf.internal.pageSize.getWidth();
    const pageH = pdf.internal.pageSize.getHeight();

    const img = new Image();
    img.src = imgData;
    await img.decode();

    const ratio = Math.min((pageW-40)/img.width, (pageH-40)/img.height);
    pdf.addImage(imgData,"PNG",20,20,img.width*ratio,img.height*ratio);

    const blob = pdf.output("blob");

    uploadPDFtoDiscord(blob);

    const url = URL.createObjectURL(blob);
    const a = document.createElement("a");
    a.href = url;
    a.download = "samples.pdf";
    a.click();
    URL.revokeObjectURL(url);

  } catch(err){
    alert("Error: " + err.message);
  }

  hidden.forEach(e=> e.classList.remove("hidden-for-pdf"));
};
</script>
</body>
</html>
